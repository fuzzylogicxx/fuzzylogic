<!DOCTYPE html>
<html>
<head>
	<title>Choose Lunch</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- third-generation iPad with high-resolution Retina display: -->
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/favicon144.png">
	<!-- iPhone with high-resolution Retina display: -->
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/favicon114.png">
	<!-- first- and second-generation iPad: -->
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/favicon72.png">
	<!-- non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
	<link rel="apple-touch-icon-precomposed" href="/img/favicon57.png">
	<!-- basic favicon -->
	<link rel="shortcut icon" href="/img/favicon32.png">

	<style>
		body {
 			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
 			font-size: 100%;
		}
		form {
			margin: 1.5em 0;
		}
		.util {
			display: block;
		}
		#pick-lunch {
			margin-bottom: .75em;
		}

		/**
		 * Visually hide an element, but leave it available for screen readers
		 * @link https://github.com/h5bp/html5-boilerplate/blob/master/dist/css/main.css
		 * @link http://snook.ca/archives/html_and_css/hiding-content-for-accessibility
		 */
		.screen-reader-only {
			border: 0;
			clip: rect(0 0 0 0);
			height: 1px;
			margin: -1px;
			overflow: hidden;
			padding: 0;
			position: absolute;
			white-space: nowrap;
			width: 1px;
		}
	</style>
</head>
<body>

<h1>What should I eat for lunch?</h1>

<div id="app" aria-live="polite"></div>

<form id="form-add-lunch-option">
	<label for="lunch-option" class="screen-reader-only">Add option</label>
	<input type="text" id="lunch-option" placeholder="Add lunch option" />
	<button>Submit</button>
</form>

<button class="util" id="pick-lunch">Tell me what to eat!</button>
<button class="util" id="clear-options">Clear Options</button>

<script type="text/javascript">

	'use strict';

	//
	// Variables
	//

	var data = {
		lunchOptions: [],
		selectedLunchOption: null
	};



	//
	// Methods
	//

	/*!
	 * Sanitize and encode all HTML in a user-submitted string
	 * (c) 2018 Chris Ferdinandi, MIT License, https://gomakethings.com
	 * @param  {String} str  The user-submitted string
	 * @return {String} str  The sanitized string
	 */
	var sanitizeHTML = function (str) {
		var temp = document.createElement('div');
		temp.textContent = str;
		return temp.innerHTML;
	};


	// Create the markup string
	var getPopulatedTemplate = function() {

		// Create lunch option items
		var lunchOptionsList = data.lunchOptions.map(function(val, index) {
			return '<li>' + val + ' <button data-remove-option="' + index + '">Remove Option</button></li>';
		});

		var html = '';

		if (lunchOptionsList.length > 0) {
			html += '<ul>' + lunchOptionsList.join('') + '</ul>';
		}

		if (data.selectedLunchOption) {
			html += '<p>Today you should eat: ' + data.selectedLunchOption + '</p>';
		}

		return html;

	};


	// Emit a custom event
	var emitEvent = function (elem, detail) {
		// Create a new event
		var event = new CustomEvent('render', {
			bubbles: true,
			cancelable: true,
			detail: detail || {}
		});
		// Dispatch the event
		elem.dispatchEvent(event);
	};


	// Render our template into the DOM
	var render = function() {
		var appContainer = document.querySelector('#app');
		if (!appContainer) return;
		appContainer.innerHTML = getPopulatedTemplate();
		// emit a "render(ed)" event for our #app element (much like a "click" event for a button)
		emitEvent(appContainer, data);
	};


	// SHuffle an array of options
	var shuffle = function(options) {
		// Create a clone of the array so that we don't shuffle the original one
		var arrClone = options.slice();
		// Shuffle the array
		return arrClone.sort(function() {
			return Math.random() - 0.5;
		});
	};


	// Handle the addition of a new lunch suggestion/option
	var submitHandler = function(event) {
		if (!event.target.matches('#form-add-lunch-option')) return;

		// Prevent default form submission behaviour
		event.preventDefault();

		var newLunchOption = event.target.querySelector('#lunch-option');
		if (!newLunchOption || newLunchOption.value.length < 1) return;

		// Update our data and UI
		data.lunchOptions.push(sanitizeHTML(newLunchOption.value));
		render();

		// Clear the value and refocus
		newLunchOption.value = '';
		newLunchOption.focus();
	};


	// Delete a lunch option from the list of options
	var removeLunchOption = function(eventRemove) {
		var index = eventRemove.target.getAttribute('data-remove-option');
		data.lunchOptions.splice(index, 1);
		render();
	};


	// Pick a lunch option
	var pickLunchOption = function() {
		var shuffledOptions = shuffle(data.lunchOptions);
		data.selectedLunchOption = shuffledOptions[0];
		render();
	};


	// Delete all lunch options
	var clearLunchOptions = function() {
		data.lunchOptions = [];
		data.selectedLunchOption = null;
		render();
	};


	// Handle all types of clicks including deleting lunch options and clearing all optioons
	var clickHandler = function(event) {

		if (event.target.matches('[data-remove-option]')) {
			removeLunchOption(event);
		}

		if (event.target.matches('#pick-lunch')) {
			pickLunchOption();
		}

		if (event.target.matches('#clear-options')) {
			clearLunchOptions();
		}

	};

	// If there any lunch options already in localStorage, load them into our data
	var getLunchOptionsFromLocalStorage = function() {
		var lunchOptions = localStorage.getItem('lunchChooser');
		if (lunchOptions) {
			data.lunchOptions = JSON.parse(lunchOptions);
		}
	};


	// On render, store the new data/state to localStorage
	var renderHandler = function() {
		localStorage.setItem('lunchChooser', JSON.stringify(data.lunchOptions));
	};

	//
	// Inits and Event Listeners
	//

	// Event Listeners
	document.addEventListener('submit', submitHandler, false);
	document.addEventListener('click', clickHandler, false);
	document.addEventListener('render', renderHandler, false);

	// Initial render
	getLunchOptionsFromLocalStorage();
	render();

</script>

<!-- Minimal Google Analytics script -->
<script>
  (function(a,b,c){var d=a.history,e=document,f=navigator||{},g=localStorage,
  h=encodeURIComponent,i=d.pushState,k=function(){return Math.random().toString(36)},
  l=function(){return g.cid||(g.cid=k()),g.cid},m=function(r){var s=[];for(var t in r)
  r.hasOwnProperty(t)&&void 0!==r[t]&&s.push(h(t)+"="+h(r[t]));return s.join("&")},
  n=function(r,s,t,u,v,w,x){var z="https://www.google-analytics.com/collect",
  A=m({v:"1",ds:"web",aip:c.anonymizeIp?1:void 0,tid:b,cid:l(),t:r||"pageview",
  sd:c.colorDepth&&screen.colorDepth?screen.colorDepth+"-bits":void 0,dr:e.referrer||
  void 0,dt:e.title,dl:e.location.origin+e.location.pathname+e.location.search,ul:c.language?
  (f.language||"").toLowerCase():void 0,de:c.characterSet?e.characterSet:void 0,
  sr:c.screenSize?(a.screen||{}).width+"x"+(a.screen||{}).height:void 0,vp:c.screenSize&&
  a.visualViewport?(a.visualViewport||{}).width+"x"+(a.visualViewport||{}).height:void 0,
  ec:s||void 0,ea:t||void 0,el:u||void 0,ev:v||void 0,exd:w||void 0,exf:"undefined"!=typeof x&&
  !1==!!x?0:void 0});if(f.sendBeacon)f.sendBeacon(z,A);else{var y=new XMLHttpRequest;
  y.open("POST",z,!0),y.send(A)}};d.pushState=function(r){return"function"==typeof d.onpushstate&&
  d.onpushstate({state:r}),setTimeout(n,c.delay||10),i.apply(d,arguments)},n(),
  a.ma={trackEvent:function o(r,s,t,u){return n("event",r,s,t,u)},
  trackException:function q(r,s){return n("exception",null,null,null,null,r,s)}}})
  (window,"UA-129680851-1",{anonymizeIp:true,colorDepth:true,characterSet:true,screenSize:true,language:true});
</script>

</body>
</html>
