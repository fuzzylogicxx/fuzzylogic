webpackJsonp([13],{55:function(a,t){a.exports=function(){var a,t=function(t){a=t,a(".blocks").length&&(e(),i(),a(".block-wrap").attr("data-init",!0),r(),n(),o())},e=function(){a(".blocks").each(function(t,e){var n=a(e),r=n.find(".master.block-add-bar");n.find(".block-wrap:not([data-init])").each(function(t,e){var n=a(e),i=r.clone();i.removeClass("master").removeClass("hidden");var o=n.attr("data-block");i.find("a").each(function(t,e){var n=a(e),r=n.attr("href");n.attr("href",r+"&after="+o)}),i.appendTo(n)});var i=n.find(".block-wrap").length;i>0&&r.addClass("hidden"),n.attr("data-next-index",i)})},n=function(){a(".blocks").on("click",".block-add-bar a",function(t){t.preventDefault();var e=a(t.target);e.is(".block-add-bar a")||(e=e.parents("a"));var n=e.parents(".block-wrap"),r=n.parent(".blocks").attr("data-next-index"),i=e.attr("href");i+="&count="+r;var o=i.split("?");a.ajax(o[0],{type:"POST",data:o[1],success:function(t){n.parent(".blocks").attr("data-next-index",parseInt(r)+1),n.length?(n.after(t),n.next(".block-wrap").hide().css("visibility","hidden").slideDown("fast",function(){a(this).hide().css("visibility","").fadeIn("fast")})):e.parents(".blocks").append(t);var i=a(t);a("input[name='_blocks_deleted[]']").each(function(t,e){var n=a(e);n.val()==i.attr("data-prefix")&&n.remove()}),a(window).trigger("Perch_Init_Editors").trigger("Perch_Init_Editors_Post"),a(window).trigger("Perch.FieldTypes.redraw")}})})},r=function(){a("form").on("submit",function(){a(this).find(".block-wrap").each(function(t,e){var n=a(e),r=n.find("input.index");r.val(t)})})},i=function(){a(".block-wrap:not([data-init]) .divider .rm").each(function(t,e){var n=a(e),r=a('<a href="#">'+Perch.UI.Helpers.icon("core/cancel")+'<span aria-hidden="true">'+Perch.Lang.get("Delete this item?")+"</span></a>");r.appendTo(n)}),a(".block-wrap:not([data-init])").on("click",".divider .rm a",function(t){t.preventDefault();var e=a(this),n=e.parents(".block-wrap");n.after(a('<input type="hidden" name="_blocks_deleted[]" value="'+n.attr("data-prefix")+'" />'));var r=e.parents(".blocks");1==r.find(".block-wrap").length&&r.find(".master.block-add-bar").hide().removeClass("hidden").fadeIn("fast"),n.selfHealingRemove({speed:"fast"})})},o=function(){Perch.UI.Sortables.makeSortable(".blocks",{items:"> .block-wrap",handle:".divider",axis:"y"})},c=function(t){a(t).on("Perch_Init_Editors",function(){e(),i(),a(".block-wrap").attr("data-init",!0)})};return{init:t,reinit:e,registerEvents:c}}()}});